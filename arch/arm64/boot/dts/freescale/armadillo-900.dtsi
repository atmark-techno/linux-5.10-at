// SPDX-License-Identifier: (GPL-2.0 OR MIT)
/*
 * Copyright (C) 2021 Atmark Techno, Inc. All Rights Reserved.
 */

#include "imx8ulp.dtsi"
#include "imx8ulp-rpmsg.dtsi"
#include "imx8ulp-pinfunc-m33.h"
#include <dt-bindings/input/input.h>
#include <dt-bindings/leds/common.h>

/ {
	model = "Atmark-Techno Armadillo-900";
	compatible = "atmark,armadillo-900", "fsl,imx8ulp";

	reserved-memory {
		#address-cells = <2>;
		#size-cells = <2>;
		ranges;

		linux,cma {
			compatible = "shared-dma-pool";
			reusable;
			size = <0 0x28000000>;
			linux,cma-default;
		};

		rsc_table: rsc_table@1fff8000{
			reg = <0 0x1fff8000 0 0x1000>;
			no-map;
		};

		vdev0vring0: vdev0vring0@aff00000 {
			reg = <0 0xaff00000 0 0x8000>;
			no-map;
		};

		vdev0vring1: vdev0vring1@aff08000 {
			reg = <0 0xaff08000 0 0x8000>;
			no-map;
		};

		vdev1vring0: vdev1vring0@aff10000 {
			reg = <0 0xaff10000 0 0x8000>;
			no-map;
		};

		vdev1vring1: vdev1vring1@aff18000 {
			reg = <0 0xaff18000 0 0x8000>;
			no-map;
		};

		ele_reserved: ele-reserved@aff20000 {
			compatible = "shared-dma-pool";
			reg = <0 0xaff20000 0 0x10000>;
			no-map;
		};

		vdevbuffer: vdevbuffer@a8400000 {
			compatible = "shared-dma-pool";
			reg = <0 0xa8400000 0 0x100000>;
			no-map;
		};
	};

	leds {
		compatible = "gpio-leds";

		enet_led {
			label = "enet_led";
			gpios = <&gpioe 13 GPIO_ACTIVE_HIGH>;
			linux,default-trigger = "29950000.ethernet-1:00:100Mbps";
		};
	};

	// secure element
	se_en: se-enable {
		compatible = "gpio-reset";
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_se_enable>;
		reset-gpios = <&gpiof 12 GPIO_ACTIVE_LOW>;
		reset-assert-in-suspend;
	};
};

// secure element
&i2c_rpbus_2 {
	#address-cells = <1>;
	#size-cells = <0>;
	status = "okay";
};


&imx8ulp_cm33 {
	ipc-only;
	rsc-da=<0x1fff8000>;
	mbox-names = "tx", "rx", "rxdb";
	mboxes = <&mu 0 1
			&mu 1 1
			&mu 3 1>;
	memory-region = <&vdevbuffer>, <&vdev0vring0>, <&vdev0vring1>,
			<&vdev1vring0>, <&vdev1vring1>, <&rsc_table>;
	status = "okay";
};

&mu {
	status = "okay";
};

// emmc
&usdhc0 {
	pinctrl-names = "default", "state_100mhz", "state_200mhz", "sleep";
	pinctrl-0 = <&pinctrl_usdhc0>;
	pinctrl-1 = <&pinctrl_usdhc0>;
	pinctrl-2 = <&pinctrl_usdhc0>;
	pinctrl-3 = <&pinctrl_usdhc0>;
	non-removable;
	bus-width = <8>;
	status = "okay";
};

//ethernet PHY
&fec {
	pinctrl-names = "default", "sleep";
	pinctrl-0 = <&pinctrl_enet>;
	pinctrl-1 = <&pinctrl_enet>;
	phy-mode = "rmii";
	phy-handle = <&ethphy>;
	status = "okay";
	phy-reset-gpios = <&gpiof 13 GPIO_ACTIVE_LOW>;
	mdio {
		#address-cells = <1>;
		#size-cells = <0>;

		ethphy: ethernet-phy {
			compatible = "ethernet-phy-ieee802.3-c22";
			reg = <0>;

			ti,dac-cfg-0 = <0x0c40>;
			ti,dac-cfg-1 = <0x000f>;
		};
	};
};

// comm with ELE, used by fuse
&ele_fw2 {
	memory-region = <&ele_reserved>;
};

&iomuxc1 {

	pinctrl_enet: enetgrp {
		fsl,pins = <
			MX8ULP_PAD_PTE14__ENET0_MDIO	0x3
			MX8ULP_PAD_PTE15__ENET0_MDC		0x3
			MX8ULP_PAD_PTE16__ENET0_TXEN	0x3
			MX8ULP_PAD_PTE17__ENET0_RXER	0x3
			MX8ULP_PAD_PTE18__ENET0_CRS_DV	0x3
			MX8ULP_PAD_PTE19__ENET0_REFCLK	0x3
			MX8ULP_PAD_PTE20__ENET0_RXD1	0x3
			MX8ULP_PAD_PTE21__ENET0_RXD0	0x3
			MX8ULP_PAD_PTE22__ENET0_TXD1	0x3
			MX8ULP_PAD_PTE23__ENET0_TXD0	0x3
			MX8ULP_PAD_PTF13__PTF13			0x3
			MX8ULP_PAD_PTE13__PTE13			0x3
		>;
	};

	pinctrl_usdhc0: usdhc0grp {
		fsl,pins = <
			MX8ULP_PAD_PTD1__SDHC0_CMD	0x3
			MX8ULP_PAD_PTD2__SDHC0_CLK	0x10002
			MX8ULP_PAD_PTD10__SDHC0_D0	0x3
			MX8ULP_PAD_PTD9__SDHC0_D1	0x3
			MX8ULP_PAD_PTD8__SDHC0_D2	0x3
			MX8ULP_PAD_PTD7__SDHC0_D3	0x3
			MX8ULP_PAD_PTD6__SDHC0_D4	0x3
			MX8ULP_PAD_PTD5__SDHC0_D5	0x3
			MX8ULP_PAD_PTD4__SDHC0_D6	0x3
			MX8ULP_PAD_PTD3__SDHC0_D7	0x3
			MX8ULP_PAD_PTD11__SDHC0_DQS	0x10002
			MX8ULP_PAD_PTD0__SDHC0_RESET_B	0x3
		>;
	};

	pinctrl_se_enable: seenablegrp {
		fsl,pins = <
			MX8ULP_PAD_PTF12__PTF12		0x3
		>;
	};
};
